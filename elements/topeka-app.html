<!--
Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="topeka-categories.html">
<link rel="import" href="topeka-category.html">
<link rel="import" href="topeka-leaderboard.html">
<link rel="import" href="topeka-profile.html">
<link rel="import" href="../components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="../components/core-media-query/core-media-query.html">

<polymer-element name="topeka-app" attributes="user categories" vertical layout>
<template>
  
  <core-animated-pages selected="{{selected}}" transitions="cross-fade-all hero-transition" flex>
  
    <topeka-categories id="categories" name="categories" user="{{user}}" 
      categories="{{categories}}" category="{{category}}" wide="{{wide}}" 
      on-core-activate="{{categorySelect}}"></topeka-categories>
  
    <topeka-category id="category" name="category" user="{{user}}" category="{{category}}" wide="{{wide}}"></topeka-category>
      
    <topeka-leaderboard name="leaderboard" user="{{user}}"></topeka-leaderboard>
    
    <topeka-profile name="profile" user="{{user}}"></topeka-profile>
    
  </core-animated-pages>
  
  <core-media-query query="min-width: {{responsiveWidth}}" queryMatches="{{wide}}"></core-media-query>

</template>
<script>

  Polymer('topeka-app', {
    
    selected: 'categories',
    responsiveWidth: '900px',
    
    observe: {
      'user': 'computeScore'
    },
    
    eventDelegates: {
      'main': 'showCategories',
      'score-update': 'computeScore'
    },
    
    showCategories: function() {
      this.selected = 'categories';
    },
    
    showCategory: function() {
      this.selected = 'category';
    },
    
    showLeaderboard: function() {
      this.selected = 'leaderboard';
    },
    
    showProfile: function() {
      this.selected = 'profile';
    },
    
    categorySelect: function() {
      if (this.category) {
        var n = this.category.name;
        if (n === 'leaderboard') {
          this.showLeaderboard();
        } else if (n === 'profile') {
          this.showProfile();
        } else {
          this.showCategory();
        }
      }
    },
    
    computeScore: function() {
      var pts = 0;
      if (this.user) {
        var ss = this.user.scores;
        for (var n in ss) {
          pts += this.sumPts(ss[n]);
        }
      }
      this.user.score = pts;
    },
    
    sumPts: function(s) {
      var pts = 0;
      for (var i = 0; i < s.length; i++) {
        pts += s[i];
      }
      return pts;
    }
    
  });

</script>
</polymer-element>